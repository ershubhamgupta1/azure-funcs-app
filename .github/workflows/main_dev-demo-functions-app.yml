name: Deploy Azure Function App

on:
  push:
    branches:
      - main  # Deploys when code is pushed to the main branch
  workflow_dispatch:  # Allows manual trigger

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository
      - name: 'Checkout GitHub Action'
        uses: actions/checkout@v3

      # Set up Node.js (if using JavaScript/TypeScript for Azure Functions)
      - name: 'Set up Node.js'
        uses: actions/setup-node@v3
        with:
          node-version: '16.x'  # Use Node.js version that matches Azure Function runtime

      # Install dependencies (if applicable)
      - name: 'Install dependencies'
        run: npm install
        working-directory: ./ # Adjust if your function app is in a subdirectory

      # Log in to Azure using a service principal
      - name: 'Login via Azure CLI'
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}  # Add Azure credentials to GitHub secrets

      # Deploy to Azure Functions
      - name: 'Deploy Azure Function App'
        uses: azure/functions-action@v1
        with:
          app-name: 'your-function-app-name'  # Azure Function App name
          package: '.'  # Path to your function app's code, adjust if needed
          publish-profile: ${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE }} # Azure Function App publish profile secret

